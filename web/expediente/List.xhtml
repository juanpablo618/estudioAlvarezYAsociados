<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <ui:composition template="/template.xhtml">

        <ui:define name="body">
            <center style="background-color: #f4f8fa">
                    <div><h:graphicImage value="../faces/resources/images/2019-10-29.png" style="width: 20%;"/>
                    </div>
                </center>
            
                   <h:form style="float: right; background-color: #F4F8FA">   
                        <p:selectOneMenu required="true" requiredMessage="debe seleccionar un estado del tramite correcto" id="estadoDelTramite" value="#{expedienteController.estadoDelTramiteSelected}">
                        <f:selectItem itemLabel=" -- Elige un Estado del tramite --"  noSelectionOption="true"  />
                        <f:selectItems value="#{estadoDelTramiteController.items}" var="estado" itemLabel="#{estado.estado}" itemValue="#{estado.estado}" />
                        </p:selectOneMenu><br></br>
                        <h:commandButton  value="Filtrar por Est. del tramite" actionListener="#{expedienteController.filtrarPorEstadoDelTramite(expedienteController.getEstadoDelTramiteSelected())}"
                                      style="width: 82%; padding: 0.5%; font-family: bolt; font-weight:bold; background: #4fb2e1; border-color: #9FCBD4;color: white; border-radius: 7px 7px 7px 7px; margin-left: 10px;" />
                    </h:form>
                  
            <h:form id="ExpedienteListForm" style=" background-color: #F4F8FA;">
                
                <div > 
                    <p:splitButton id="basic" value="CREAR EXPEDIENTE" action="#{buttonView.save}"  icon="pi pi-save">
                        <p:menuitem style="background-color: white !important" value="Administrativo" actionListener="#{expedienteController.prepareCreateExpAdministrativo()}" update=":ExpedienteCreateForm" oncomplete="PF('ExpedienteCreateDialog').show()"  icon="pi pi-refresh" />
                            <p:separator />
                            <p:menuitem style="background-color: white !important" value="Judicial" actionListener="#{expedienteController.prepareCreateExpJudicial()}" update=":ExpedienteJudicialCreateForm" oncomplete="PF('ExpedienteJudicialCreateDialog').show()" icon="pi pi-times" />
                            <p:separator />
                            <p:menuitem style="background-color: white !important" value="Sin carpeta" actionListener="#{expedienteController.prepareCreateExpSinCarpeta()}" update=":ExpedienteSinCarpetaCreateForm" oncomplete="PF('ExpedienteSinCarpetaCreateDialog').show()"  icon="pi pi-refresh" />
                    
                    </p:splitButton>
                <h:commandButton  value="Limpiar filtros" onclick="PF('expedientesTable').clearFilters()"   style="width: 15%; padding: 0.5%; font-family: bolt; font-weight:bold; background: #4fb2e1; border-color: #9FCBD4;color: white; border-radius: 7px 7px 7px 7px; " />
                
                      
                    <h:commandLink style="float: right">
                                <h:graphicImage value="../faces/resources/images/pdf.png" />
                                <p:dataExporter type="pdf" target="datalist" fileName="expedientesFiltrados" pageOnly="true" />
                    </h:commandLink>
                    
                    <h:commandLink style="float: right" >
                                <h:graphicImage value="../faces/resources/images/pdf.png" />
                                <p:dataExporter type="pdf" target="datalist" fileName="todasLosExpedientes" pageOnly="false" />
                    </h:commandLink>
                    
                </div>
                <br></br>
                
                    <p:dataTable id="datalist" value="#{expedienteController.items}" var="item"
                                 selectionMode="single" selection="#{expedienteController.selected}"
                                 paginator="true"
                                 rowKey="#{item.idExpediente}"
                                 widgetVar="expedientesTable"
                                 rows="50"
                                 rowsPerPageTemplate="50,60,70,80,90"
                                 filteredValue="#{expedienteController.filteredExpedientes}"
                                 resizableColumns="true"
                                 rendered="true"  
                                 emptyMessage="no existen expedientes con ese filtro"
                                 >

                        <p:ajax event="rowSelect"   update="createButton "/>
                        <p:ajax event="rowUnselect" update="createButton "/>
                        
                        <p:growl  id="message" showDetail="true" />

                        <p:column filterBy="#{item.orden}" sortBy="#{item.orden}" styleClass="centeredColumnContent#{item.getTipoDeExpedienteParaEstilo()}" filterMatchMode="exact">
                            <f:facet name="header">
                                <h:outputText value="#{bundle.ListExpedienteTitle_orden}"/>
                            </f:facet>
                            <h:outputText value="#{item.orden}"/>
                        </p:column>

                        <p:column  filterBy="#{item.apellidoYNombre}"  styleClass="centeredColumnContent#{item.getTipoDeExpedienteParaEstilo()}" filterMatchMode="contains">
                            <f:facet name="header" >
                                <h:outputText  value="Nombre y Apellido"/>
                            </f:facet>
                            <h:outputText  id="JuanCuello" value="#{ item.apellidoYNombre}"/>
                        </p:column>
                        
                        <p:column filterBy="#{item.getCuitRecordado()}" sortBy="#{item.getCuitRecordado()}" styleClass="centeredColumnContent#{item.getTipoDeExpedienteParaEstilo()}" filterMatchMode="contains">
                            <f:facet name="header">
                                <h:outputText value="DNI"/>
                            </f:facet>
                            <h:outputText value="#{item.getCuitRecordado()}"/>
                        </p:column>

                        <p:column style="text-align: center; " styleClass="centeredColumnContent#{item.getTipoDeExpedienteParaEstilo()}" exportable="false">
                            
                            <f:facet name="header">
                                <h:outputText value="ACCIONES"/>
                            </f:facet>
                             
                            <p:commandButton class="linea"  update=":ExpedienteViewClavesForm2" oncomplete="PF('ExpedienteViewClavesDialog2').show()" icon="ui-icon-locked" title="Claves">
                                   <f:setPropertyActionListener value="#{item}" target="#{expedienteController.selected}" />
                            </p:commandButton>
                            
                            <p:commandButton class="linea"  update=":ExpedienteEditForm" oncomplete="PF('ExpedienteEditDialog').show()"  icon="ui-icon-search" rendered="#{item.tipoDeExpediente eq 'administrativo'}" title="Ver exp. Administrativo">
                                <f:setPropertyActionListener value="#{item}" target="#{expedienteController.selected}" />
                            </p:commandButton>
                            
                            <p:commandButton class="linea"  update=":ExpedienteSinCarpetaEditForm" oncomplete="PF('ExpedienteSinCarpetaEditDialog').show()"  icon="ui-icon-search" rendered="#{item.tipoDeExpediente eq 'sin carpeta'}" title="Ver exp. Sin Carpeta">
                                <f:setPropertyActionListener value="#{item}" target="#{expedienteController.selected}" />
                            </p:commandButton>
                            
                            <p:commandButton class="linea"  update=":ExpedienteJudicialEditForm" oncomplete="PF('ExpedienteJudicialEditDialog').show()" rendered="#{item.tipoDeExpediente eq 'judicial'}" icon="ui-icon-search" title="Ver exp. Judicial">
                                <f:setPropertyActionListener value="#{item}" target="#{expedienteController.selected}" />
                            </p:commandButton>
                            
                            <p:commandButton class="linea" update=":growl,datalist, message" oncomplete="PF('expedientesTable').clearFilters()" actionListener="#{expedienteController.destroy}"  icon="ui-icon-circle-close" title="borrar">
                                <f:setPropertyActionListener value="#{item}" target="#{expedienteController.selected}" />
                                <p:confirm header="Confirmación" message="¿Estas seguro?" icon="pi pi-exclamation-triangle" />
                            </p:commandButton>
                            
                            <p:confirmDialog  global="true" showEffect="fade" hideEffect="fade">
                                <p:commandButton update=":ExpedienteListForm" value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
                                <p:commandButton update=":ExpedienteListForm" value="No" type="button" styleClass="ui-confirmdialog-no" icon="pi pi-times" />
                            </p:confirmDialog> 
                            
                        </p:column>
                                                
                        <f:facet name="footer">
                            <p:commandButton id="createButton" rendered="false" icon="ui-icon-plus"   value="#{bundle.Create}" actionListener="#{expedienteController.prepareCreate}" update=":ExpedienteCreateForm" oncomplete="PF('ExpedienteCreateDialog').show()"/>
                        </f:facet>
                    </p:dataTable>
                         
            <p:contextMenu for="datalist">
                <p:menuitem icon="ui-icon-pencil" style="background-color: white !important" value="agregar Agenda" actionListener="#{agendaController.prepareCreate}" update=":ExpedienteViewFormParaAgenda" oncomplete="PF('ExpedienteViewDialogParaAgenda').show()" />             
            
                <p:menuitem icon="ui-icon-pencil" style="background-color: white !important" value="agregar Turno" actionListener="#{turnoController.prepareCreate}" update=":ExpedienteViewFormParaTurno" oncomplete="PF('ExpedienteViewDialogParaTurno').show()" />             
            
            </p:contextMenu>    
                
            </h:form>

            <ui:include src="Create.xhtml"/>
            <ui:include src="CreateExpJudicial.xhtml"/>
            <ui:include src="CreateExpSinCarpeta.xhtml"/>
            <ui:include src="Edit.xhtml"/>
            <ui:include src="EditExpSinCarpeta.xhtml"/>
            <ui:include src="EditExpJudicial.xhtml"/>
            <ui:include src="ViewParaAgenda.xhtml"/>
            <ui:include src="View_1.xhtml"/>
            <ui:include src="ViewExpJudicial.xhtml"/>
            <ui:include src="ViewParaTurno.xhtml"/>
        </ui:define>
    </ui:composition>

</html>